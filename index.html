<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Music Composer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .play-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        
        .stop-btn {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #ff9800, #e68900);
            color: white;
        }
        
        .export-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .tracks {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .track-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .track-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-slider {
            width: 100px;
            height: 5px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            appearance: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        
        .note-input {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .note-input input, .note-input select {
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .add-note-btn {
            background: linear-gradient(45deg, #9C27B0, #7B1FA2);
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .notes-display {
            margin-top: 15px;
            min-height: 60px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .note-chip {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            margin: 2px;
            border-radius: 15px;
            font-size: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .tempo-control {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .tempo-control label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .tempo-slider {
            width: 200px;
            height: 5px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            appearance: none;
        }
        
        .tempo-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FF5722;
            cursor: pointer;
        }
        
        .musical-tools {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chord-builder, .scale-helper {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .chord-builder h3, .scale-helper h3 {
            margin: 0 0 15px 0;
            color: #fff;
            text-align: center;
        }
        
        .chord-presets {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .preset-btn, .tool-btn {
            background: linear-gradient(45deg, #8E24AA, #7B1FA2);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .preset-btn:hover, .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(142, 36, 170, 0.4);
        }
        
        .chord-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 50px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        .chord-tools {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .scale-helper select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .scale-notes {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 2px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .info-text {
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }
        
        .chord-chip {
            display: inline-block;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 12px;
            margin: 3px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .chord-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);
        }
        
        .sequencer-grid {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(32, 1fr);
            gap: 2px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
        }
        
        .step {
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .step.active {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        
        .step.playing {
            background: #FFD700;
            animation: pulse 0.2s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @media (max-width: 768px) {
            .musical-tools {
                grid-template-columns: 1fr;
            }
            
            .chord-presets, .chord-tools {
                justify-content: center;
            }
            
            .sequencer-grid {
                grid-template-columns: repeat(16, 1fr);
            }
            
            .step {
                width: 15px;
                height: 15px;
            }
        }
    </style>
</head>
<body>
            <div class="container">
        <h1>üéµ Interactive Music Composer</h1>
        
        <div class="controls">
            <button class="play-btn" onclick="playSequence()">‚ñ∂ Play</button>
            <button class="stop-btn" onclick="stopSequence()">‚èπ Stop</button>
            <button class="clear-btn" onclick="clearAll()">üóë Clear All</button>
            <button class="export-btn" onclick="exportComposition()">üì§ Export</button>
            <input type="file" id="import-file" accept=".txt" style="display: none;" onchange="importComposition(event)">
            <button class="export-btn" onclick="document.getElementById('import-file').click()">üì• Import</button>
        </div>
        
        <div class="musical-tools">
            <div class="chord-builder">
                <h3>üéπ Chord Progression Builder</h3>
                <div class="chord-presets">
                    <button class="preset-btn" onclick="loadProgression('canon')">Canon in D</button>
                    <button class="preset-btn" onclick="loadProgression('pop')">I-V-vi-IV</button>
                    <button class="preset-btn" onclick="loadProgression('blues')">12-Bar Blues</button>
                    <button class="preset-btn" onclick="loadProgression('jazz')">ii-V-I</button>
                </div>
                <div class="chord-display" id="chord-display">
                    <span class="info-text">Select a progression above or build your own</span>
                </div>
                <div class="chord-tools">
                    <button class="tool-btn" onclick="generateBassLine()">üé∏ Auto Bass Line</button>
                    <button class="tool-btn" onclick="generateArpeggio()">ü™ï Auto Arpeggio</button>
                    <button class="tool-btn" onclick="harmonizeMelody()">üéº Harmonize Melody</button>
                </div>
            </div>
            
            <div class="scale-helper">
                <h3>üéµ Scale Helper</h3>
                <select id="key-select" onchange="updateScaleNotes()">
                    <option value="C">C Major</option>
                    <option value="G">G Major</option>
                    <option value="D" selected>D Major</option>
                    <option value="A">A Major</option>
                    <option value="E">E Major</option>
                    <option value="F">F Major</option>
                    <option value="Am">A Minor</option>
                    <option value="Em">E Minor</option>
                    <option value="Bm">B Minor</option>
                </select>
                <div class="scale-notes" id="scale-notes">
                    D E F# G A B C#
                </div>
            </div>
        </div>

        <div class="tempo-control">
            <label for="tempo">Tempo: <span id="tempo-value">120</span> BPM</label>
            <input type="range" id="tempo" class="tempo-slider" min="60" max="200" value="120" 
                   oninput="updateTempo(this.value)">
        </div>
        
        <div class="tracks" id="tracks">
            <!-- Tracks will be generated here -->
        </div>
    </div>

    <script>
        // Global variables
        let isPlaying = false;
        let currentStep = 0;
        let instruments = {};
        let sequences = {};
        let trackNotes = {};
        let trackVolumes = {};
        let stepTimeout;
        let reverb, compressor;
        let currentKey = 'D';
        let currentProgression = [];
        
        // Musical data
        const scaleNotes = {
            'C': ['C', 'D', 'E', 'F', 'G', 'A', 'B'],
            'G': ['G', 'A', 'B', 'C', 'D', 'E', 'F#'],
            'D': ['D', 'E', 'F#', 'G', 'A', 'B', 'C#'],
            'A': ['A', 'B', 'C#', 'D', 'E', 'F#', 'G#'],
            'E': ['E', 'F#', 'G#', 'A', 'B', 'C#', 'D#'],
            'F': ['F', 'G', 'A', 'Bb', 'C', 'D', 'E'],
            'Am': ['A', 'B', 'C', 'D', 'E', 'F', 'G'],
            'Em': ['E', 'F#', 'G', 'A', 'B', 'C', 'D'],
            'Bm': ['B', 'C#', 'D', 'E', 'F#', 'G', 'A']
        };
        
        const chordProgressions = {
            canon: {
                name: "Canon in D",
                chords: ['D', 'A', 'Bm', 'F#m', 'G', 'D', 'G', 'A'],
                key: 'D'
            },
            pop: {
                name: "I-V-vi-IV",
                chords: ['D', 'A', 'Bm', 'G'],
                key: 'D'
            },
            blues: {
                name: "12-Bar Blues",
                chords: ['D', 'D', 'D', 'D', 'G', 'G', 'D', 'D', 'A', 'G', 'D', 'A'],
                key: 'D'
            },
            jazz: {
                name: "ii-V-I",
                chords: ['Em', 'A', 'D'],
                key: 'D'
            }
        };
        
        // Chord to note mappings
        const chordNotes = {
            'D': ['D', 'F#', 'A'],
            'A': ['A', 'C#', 'E'],
            'Bm': ['B', 'D', 'F#'],
            'F#m': ['F#', 'A', 'C#'],
            'G': ['G', 'B', 'D'],
            'Em': ['E', 'G', 'B'],
            'C': ['C', 'E', 'G'],
            'F': ['F', 'A', 'C']
        };
        
        // Initialize Tone.js and effects
        const initAudio = async () => {
            if (Tone.context.state !== 'running') {
                await Tone.start();
            }
            
            // Create global effects if not already created
            if (!reverb) {
                reverb = new Tone.Reverb({
                    decay: 1.5,
                    wet: 0.2
                }).toDestination();
                
                compressor = new Tone.Compressor({
                    threshold: -18,
                    ratio: 8,
                    attack: 0.003,
                    release: 0.25
                }).connect(reverb);
                
                // Small delay to ensure effects are ready
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        };
        
        // Advanced instrument definitions
        const instrumentTypes = {
            piano: {
                name: "üéπ Piano",
                synth: () => {
                    // FM synthesis to simulate piano hammer strikes
                    const piano = new Tone.FMSynth({
                        harmonicity: 2.1,
                        modulationIndex: 12,
                        oscillator: { type: "sine" },
                        envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 1.2 },
                        modulation: { type: "square" },
                        modulationEnvelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
                    });
                    
                    // Connect to effects chain
                    if (compressor) {
                        piano.connect(compressor);
                    } else {
                        piano.toDestination();
                    }
                    return piano;
                }
            },
            guitar: {
                name: "üé∏ Guitar", 
                synth: () => {
                    // Enhanced pluck synthesis
                    const guitar = new Tone.PluckSynth({
                        attackNoise: 2,
                        dampening: 2000,
                        resonance: 0.9
                    });
                    
                    if (compressor) {
                        guitar.connect(compressor);
                    } else {
                        guitar.toDestination();
                    }
                    return guitar;
                }
            },
            bass: {
                name: "üé∏ Bass",
                synth: () => {
                    // FM synthesis optimized for bass
                    const bass = new Tone.FMSynth({
                        harmonicity: 1,
                        modulationIndex: 10,
                        oscillator: { type: "sawtooth" },
                        envelope: { attack: 0.01, decay: 0.3, sustain: 0.4, release: 1.5 },
                        modulation: { type: "square" },
                        modulationEnvelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.1 }
                    });
                    
                    if (compressor) {
                        bass.connect(compressor);
                    } else {
                        bass.toDestination();
                    }
                    return bass;
                }
            },
            drums: {
                name: "ü•Å Drums",
                synth: () => {
                    // Better drum synthesis
                    const drums = new Tone.MembraneSynth({
                        pitchDecay: 0.08,
                        octaves: 2,
                        oscillator: { type: "sine" },
                        envelope: { attack: 0.001, decay: 0.2, sustain: 0.01, release: 0.8 }
                    });
                    
                    if (compressor) {
                        drums.connect(compressor);
                    } else {
                        drums.toDestination();
                    }
                    return drums;
                }
            },
            violin: {
                name: "üéª Violin",
                synth: () => {
                    // AM synthesis to simulate bowing
                    const violin = new Tone.AMSynth({
                        harmonicity: 3.01,
                        oscillator: { type: "sawtooth" },
                        envelope: { attack: 0.4, decay: 0.01, sustain: 1.0, release: 1.2 },
                        modulation: { type: "square" },
                        modulationEnvelope: { attack: 0.5, decay: 0.01, sustain: 1.0, release: 1.2 }
                    });
                    
                    if (compressor) {
                        violin.connect(compressor);
                    } else {
                        violin.toDestination();
                    }
                    return violin;
                }
            },
            harp: {
                name: "ü™ï Harp",
                synth: () => {
                    // Enhanced pluck with longer sustain
                    const harp = new Tone.PluckSynth({
                        attackNoise: 0.1,
                        dampening: 1000,
                        resonance: 0.95
                    });
                    
                    if (compressor) {
                        harp.connect(compressor);
                    } else {
                        harp.toDestination();
                    }
                    return harp;
                }
            },
            saxophone: {
                name: "üé∑ Saxophone",
                synth: () => {
                    // FM synthesis for reed instrument
                    const sax = new Tone.FMSynth({
                        harmonicity: 3.5,
                        modulationIndex: 20,
                        oscillator: { type: "sawtooth" },
                        envelope: { attack: 0.1, decay: 0.2, sustain: 0.7, release: 1.0 },
                        modulation: { type: "sine" },
                        modulationEnvelope: { attack: 0.1, decay: 0.1, sustain: 0.6, release: 0.8 }
                    });
                    
                    if (compressor) {
                        sax.connect(compressor);
                    } else {
                        sax.toDestination();
                    }
                    return sax;
                }
            },
            vocal: {
                name: "üé§ Vocal",
                synth: () => {
                    // AM synthesis for vocal character
                    const vocal = new Tone.AMSynth({
                        harmonicity: 2,
                        oscillator: { type: "sine" },
                        envelope: { attack: 0.05, decay: 0.1, sustain: 0.8, release: 1.0 },
                        modulation: { type: "triangle" },
                        modulationEnvelope: { attack: 0.05, decay: 0.1, sustain: 0.3, release: 0.8 }
                    });
                    
                    if (compressor) {
                        vocal.connect(compressor);
                    } else {
                        vocal.toDestination();
                    }
                    return vocal;
                }
            }
        };
        
        // Initialize tracks
        const initTracks = async () => {
            await initAudio(); // Make sure effects are created first
            
            const tracksContainer = document.getElementById('tracks');
            
            Object.keys(instrumentTypes).forEach(type => {
                const track = createTrack(type, instrumentTypes[type].name);
                tracksContainer.appendChild(track);
                
                // Initialize instrument and sequence - instruments will connect to effects automatically
                instruments[type] = instrumentTypes[type].synth();
                sequences[type] = new Array(32).fill(false);
                trackNotes[type] = [];
                trackVolumes[type] = 0.7;
            });
        };
        
        // Create track element
        const createTrack = (type, name) => {
            const trackDiv = document.createElement('div');
            trackDiv.className = 'track';
            
            trackDiv.innerHTML = `
                <div class="track-header">
                    <div class="track-title">${name}</div>
                    <div class="volume-control">
                        <span>Vol:</span>
                        <input type="range" class="volume-slider" min="0" max="1" step="0.1" value="0.7"
                               onchange="setVolume('${type}', this.value)">
                    </div>
                </div>
                <div class="note-input">
                    <input type="text" placeholder="Note (e.g., C4)" id="${type}-note">
                    <select id="${type}-duration">
                        <option value="8n">8th note</option>
                        <option value="4n" selected>Quarter note</option>
                        <option value="2n">Half note</option>
                        <option value="1n">Whole note</option>
                    </select>
                    <button class="add-note-btn" onclick="addNote('${type}')">Add Note</button>
                </div>
                <div class="sequencer-grid" id="${type}-grid">
                    ${Array(32).fill().map((_, i) => 
                        `<div class="step" onclick="toggleStep('${type}', ${i})"></div>`
                    ).join('')}
                </div>
                <div class="notes-display" id="${type}-notes"></div>
            `;
            
            return trackDiv;
        };
        
        // Toggle step in sequencer
        const toggleStep = (instrument, step) => {
            sequences[instrument][step] = !sequences[instrument][step];
            const stepElement = document.querySelectorAll(`#${instrument}-grid .step`)[step];
            stepElement.classList.toggle('active', sequences[instrument][step]);
        };
        
        // Set volume for instrument
        const setVolume = (instrument, volume) => {
            const vol = parseFloat(volume);
            trackVolumes[instrument] = vol;
            if (instruments[instrument]) {
                instruments[instrument].volume.value = Tone.gainToDb(vol);
            }
        };
        
        // Add note to track
        const addNote = (instrument) => {
            const noteInput = document.getElementById(`${instrument}-note`);
            const durationSelect = document.getElementById(`${instrument}-duration`);
            const notesDisplay = document.getElementById(`${instrument}-notes`);
            
            const note = noteInput.value.trim();
            const duration = durationSelect.value;
            
            if (note) {
                // Store note data
                trackNotes[instrument].push({ note, duration });
                
                const noteChip = document.createElement('span');
                noteChip.className = 'note-chip';
                noteChip.textContent = `${note} (${duration})`;
                noteChip.onclick = () => {
                    // Play note when clicked
                    initAudio().then(() => {
                        if (instrument === 'drums') {
                            // Play different drum sounds based on note
                            const drumNote = note.toUpperCase();
                            if (drumNote.includes('KICK') || drumNote.includes('K')) {
                                instruments[instrument].triggerAttackRelease('C1', duration);
                            } else if (drumNote.includes('SNARE') || drumNote.includes('S')) {
                                instruments[instrument].triggerAttackRelease('C3', duration);
                            } else if (drumNote.includes('HAT') || drumNote.includes('H')) {
                                instruments[instrument].triggerAttackRelease('C5', duration);
                            } else {
                                instruments[instrument].triggerAttackRelease('C2', duration);
                            }
                        } else {
                            instruments[instrument].triggerAttackRelease(note, duration);
                        }
                    });
                };
                notesDisplay.appendChild(noteChip);
                noteInput.value = '';
            }
        };
        
        // Update tempo
        const updateTempo = (value) => {
            Tone.Transport.bpm.value = parseInt(value);
            document.getElementById('tempo-value').textContent = value;
        };
        
        // Play sequence
        const playSequence = async () => {
            await initAudio();
            
            if (isPlaying) return;
            isPlaying = true;
            currentStep = 0;
            
            const stepDuration = 60 / (Tone.Transport.bpm.value * 4); // 16th notes
            
            const playStep = () => {
                if (!isPlaying) return;
                
                // Clear previous playing indicators
                document.querySelectorAll('.step.playing').forEach(el => {
                    el.classList.remove('playing');
                });
                
                // Highlight current step
                Object.keys(sequences).forEach(instrument => {
                    const stepElement = document.querySelectorAll(`#${instrument}-grid .step`)[currentStep];
                    stepElement.classList.add('playing');
                    
                    // Play note if step is active
                    if (sequences[instrument][currentStep]) {
                        if (instrument === 'drums') {
                            // Cycle through different drum sounds for sequencer
                            const drumSounds = ['C1', 'C3', 'C5', 'C2'];
                            const drumNote = drumSounds[currentStep % 4];
                            instruments[instrument].triggerAttackRelease(drumNote, '16n');
                        } else {
                            // Use a default note for sequencer playback
                            const defaultNotes = {
                                piano: 'C4',
                                guitar: 'E3',
                                bass: 'C2',
                                violin: 'G4',
                                harp: 'C5',
                                saxophone: 'F4',
                                vocal: 'A4'
                            };
                            instruments[instrument].triggerAttackRelease(defaultNotes[instrument] || 'C4', '16n');
                        }
                    }
                });
                
                currentStep = (currentStep + 1) % 32;
                stepTimeout = setTimeout(playStep, stepDuration * 1000);
            };
            
            playStep();
        };
        
        // Stop sequence
        const stopSequence = () => {
            isPlaying = false;
            clearTimeout(stepTimeout);
            
            // Clear playing indicators
            document.querySelectorAll('.step.playing').forEach(el => {
                el.classList.remove('playing');
            });
        };
        
        // Musical Intelligence Functions
        
        // Load chord progression
        const loadProgression = (type) => {
            const progression = chordProgressions[type];
            if (!progression) return;
            
            currentProgression = progression.chords;
            currentKey = progression.key;
            
            // Update display
            const display = document.getElementById('chord-display');
            display.innerHTML = progression.chords.map(chord => 
                `<span class="chord-chip" onclick="playChord('${chord}')">${chord}</span>`
            ).join('');
            
            // Update key selector
            document.getElementById('key-select').value = progression.key;
            updateScaleNotes();
        };
        
        // Play chord
        const playChord = async (chord) => {
            await initAudio();
            const notes = chordNotes[chord];
            if (notes && instruments.piano) {
                notes.forEach((note, index) => {
                    setTimeout(() => {
                        instruments.piano.triggerAttackRelease(note + '4', '2n');
                    }, index * 50);
                });
            }
        };
        
        // Generate bass line from chord progression
        const generateBassLine = () => {
            if (currentProgression.length === 0) {
                alert('Load a chord progression first!');
                return;
            }
            
            // Clear existing bass notes
            trackNotes.bass = [];
            document.getElementById('bass-notes').innerHTML = '';
            
            // Generate bass line
            currentProgression.forEach((chord, index) => {
                const rootNote = chordNotes[chord] ? chordNotes[chord][0] + '2' : 'C2';
                const noteData = { note: rootNote, duration: '2n' };
                trackNotes.bass.push(noteData);
                
                // Add to display
                const noteChip = document.createElement('span');
                noteChip.className = 'note-chip';
                noteChip.textContent = `${rootNote} (2n)`;
                noteChip.onclick = () => {
                    initAudio().then(() => {
                        instruments.bass.triggerAttackRelease(rootNote, '2n');
                    });
                };
                document.getElementById('bass-notes').appendChild(noteChip);
            });
            
            alert(`Generated ${currentProgression.length} bass notes!`);
        };
        
        // Generate arpeggio pattern
        const generateArpeggio = () => {
            if (currentProgression.length === 0) {
                alert('Load a chord progression first!');
                return;
            }
            
            // Clear existing harp notes
            trackNotes.harp = [];
            document.getElementById('harp-notes').innerHTML = '';
            
            // Generate arpeggios
            currentProgression.forEach(chord => {
                const notes = chordNotes[chord];
                if (notes) {
                    notes.forEach(note => {
                        const noteData = { note: note + '4', duration: '8n' };
                        trackNotes.harp.push(noteData);
                        
                        // Add to display
                        const noteChip = document.createElement('span');
                        noteChip.className = 'note-chip';
                        noteChip.textContent = `${note}4 (8n)`;
                        noteChip.onclick = () => {
                            initAudio().then(() => {
                                instruments.harp.triggerAttackRelease(note + '4', '8n');
                            });
                        };
                        document.getElementById('harp-notes').appendChild(noteChip);
                    });
                }
            });
            
            alert(`Generated arpeggio pattern!`);
        };
        
        // Harmonize melody (add harmony to piano notes)
        const harmonizeMelody = () => {
            if (trackNotes.piano.length === 0) {
                alert('Add some piano notes first!');
                return;
            }
            
            if (currentProgression.length === 0) {
                alert('Load a chord progression first!');
                return;
            }
            
            // Clear existing violin notes
            trackNotes.violin = [];
            document.getElementById('violin-notes').innerHTML = '';
            
            // Generate harmony notes (thirds above)
            trackNotes.piano.forEach(pianoNote => {
                const noteName = pianoNote.note.replace(/\d+/, '');
                const octave = pianoNote.note.replace(/[^0-9]/g, '');
                
                // Find harmony note (third above)
                const scaleArray = scaleNotes[currentKey] || scaleNotes['D'];
                const noteIndex = scaleArray.findIndex(n => n === noteName);
                if (noteIndex !== -1) {
                    const harmonyNote = scaleArray[(noteIndex + 2) % scaleArray.length];
                    const harmonyNoteData = { 
                        note: harmonyNote + octave, 
                        duration: pianoNote.duration 
                    };
                    trackNotes.violin.push(harmonyNoteData);
                    
                    // Add to display
                    const noteChip = document.createElement('span');
                    noteChip.className = 'note-chip';
                    noteChip.textContent = `${harmonyNote}${octave} (${pianoNote.duration})`;
                    noteChip.onclick = () => {
                        initAudio().then(() => {
                            instruments.violin.triggerAttackRelease(harmonyNote + octave, pianoNote.duration);
                        });
                    };
                    document.getElementById('violin-notes').appendChild(noteChip);
                }
            });
            
            alert('Generated harmony for piano melody!');
        };
        
        // Update scale notes display
        const updateScaleNotes = () => {
            const key = document.getElementById('key-select').value;
            currentKey = key;
            const notes = scaleNotes[key] || scaleNotes['D'];
            document.getElementById('scale-notes').textContent = notes.join(' ');
        };
        
        // Clear all sequences
        const clearAll = () => {
            stopSequence();
            
            Object.keys(sequences).forEach(instrument => {
                sequences[instrument] = new Array(32).fill(false);
                trackNotes[instrument] = [];
                document.querySelectorAll(`#${instrument}-grid .step`).forEach(step => {
                    step.classList.remove('active');
                });
                document.getElementById(`${instrument}-notes`).innerHTML = '';
            });
            
            // Clear chord progression display
            currentProgression = [];
            document.getElementById('chord-display').innerHTML = '<span class="info-text">Select a progression above or build your own</span>';
        };
        
        // Export composition
        const exportComposition = () => {
            const composition = {
                tempo: Tone.Transport.bpm.value,
                sequences: sequences,
                notes: trackNotes,
                volumes: trackVolumes,
                progression: currentProgression,
                key: currentKey,
                timestamp: new Date().toISOString(),
                version: "2.0"
            };
            
            const dataStr = JSON.stringify(composition, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'text/plain' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `composition_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            link.click();
            
            alert('Composition exported! Save this .txt file and use Import to load it later.');
        };
        
        // Import composition
        const importComposition = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const composition = JSON.parse(e.target.result);
                    
                    // Clear current composition
                    clearAll();
                    
                    // Load tempo
                    if (composition.tempo) {
                        Tone.Transport.bpm.value = composition.tempo;
                        document.getElementById('tempo').value = composition.tempo;
                        document.getElementById('tempo-value').textContent = composition.tempo;
                    }
                    
                    // Load chord progression
                    if (composition.progression && composition.key) {
                        currentProgression = composition.progression;
                        currentKey = composition.key;
                        
                        const display = document.getElementById('chord-display');
                        display.innerHTML = composition.progression.map(chord => 
                            `<span class="chord-chip" onclick="playChord('${chord}')">${chord}</span>`
                        ).join('');
                        
                        document.getElementById('key-select').value = composition.key;
                        updateScaleNotes();
                    }
                    
                    // Load sequences
                    if (composition.sequences) {
                        Object.keys(composition.sequences).forEach(instrument => {
                            if (sequences[instrument]) {
                                sequences[instrument] = composition.sequences[instrument];
                                composition.sequences[instrument].forEach((active, index) => {
                                    const stepElement = document.querySelectorAll(`#${instrument}-grid .step`)[index];
                                    if (stepElement) {
                                        stepElement.classList.toggle('active', active);
                                    }
                                });
                            }
                        });
                    }
                    
                    // Load notes
                    if (composition.notes) {
                        Object.keys(composition.notes).forEach(instrument => {
                            if (trackNotes[instrument]) {
                                trackNotes[instrument] = composition.notes[instrument];
                                const notesDisplay = document.getElementById(`${instrument}-notes`);
                                composition.notes[instrument].forEach(noteData => {
                                    const noteChip = document.createElement('span');
                                    noteChip.className = 'note-chip';
                                    noteChip.textContent = `${noteData.note} (${noteData.duration})`;
                                    noteChip.onclick = () => {
                                        initAudio().then(() => {
                                            if (instrument === 'drums') {
                                                const drumNote = noteData.note.toUpperCase();
                                                if (drumNote.includes('KICK') || drumNote.includes('K')) {
                                                    instruments[instrument].triggerAttackRelease('C1', noteData.duration);
                                                } else if (drumNote.includes('SNARE') || drumNote.includes('S')) {
                                                    instruments[instrument].triggerAttackRelease('C3', noteData.duration);
                                                } else if (drumNote.includes('HAT') || drumNote.includes('H')) {
                                                    instruments[instrument].triggerAttackRelease('C5', noteData.duration);
                                                } else {
                                                    instruments[instrument].triggerAttackRelease('C2', noteData.duration);
                                                }
                                            } else {
                                                instruments[instrument].triggerAttackRelease(noteData.note, noteData.duration);
                                            }
                                        });
                                    };
                                    notesDisplay.appendChild(noteChip);
                                });
                            }
                        });
                    }
                    
                    // Load volumes
                    if (composition.volumes) {
                        Object.keys(composition.volumes).forEach(instrument => {
                            if (trackVolumes[instrument] !== undefined) {
                                const volume = composition.volumes[instrument];
                                trackVolumes[instrument] = volume;
                                const volumeSlider = document.querySelector(`#tracks input[onchange*="${instrument}"]`);
                                if (volumeSlider) {
                                    volumeSlider.value = volume;
                                    setVolume(instrument, volume);
                                }
                            }
                        });
                    }
                    
                    alert('Composition loaded successfully!');
                } catch (error) {
                    alert('Error loading composition: ' + error.message);
                }
            };
            reader.readAsText(file);
            
        // Initialize everything when page loads
        window.addEventListener('load', async () => {
            await initTracks();
            
            // Load Canon in D as demo
            loadProgression('canon');
            
            // Add some demo melody notes for Canon
            const canonMelody = [
                { note: 'D5', duration: '2n' },
                { note: 'A4', duration: '4n' },
                { note: 'B4', duration: '4n' },
                { note: 'F#4', duration: '2n' },
                { note: 'G4', duration: '4n' },
                { note: 'D4', duration: '4n' },
                { note: 'G4', duration: '2n' },
                { note: 'A4', duration: '1n' }
            ];
            
            // Add Canon melody to piano
            trackNotes.piano = canonMelody;
            const pianoNotesDisplay = document.getElementById('piano-notes');
            canonMelody.forEach(noteData => {
                const noteChip = document.createElement('span');
                noteChip.className = 'note-chip';
                noteChip.textContent = `${noteData.note} (${noteData.duration})`;
                noteChip.onclick = () => {
                    initAudio().then(() => {
                        instruments.piano.triggerAttackRelease(noteData.note, noteData.duration);
                    });
                };
                pianoNotesDisplay.appendChild(noteChip);
            });
        });
        
        // Load chord progression
        const loadProgression = (type) => {
            const progression = chordProgressions[type];
            if (!progression) return;
            
            currentProgression = progression.chords;
            currentKey = progression.key;
            
            // Update display
            const display = document.getElementById('chord-display');
            display.innerHTML = progression.chords.map(chord => 
                `<span class="chord-chip" onclick="playChord('${chord}')">${chord}</span>`
            ).join('');
            
            // Update key selector
            document.getElementById('key-select').value = progression.key;
            updateScaleNotes();
        };
        
        // Play chord
        const playChord = async (chord) => {
            await initAudio();
            const notes = chordNotes[chord];
            if (notes && instruments.piano) {
                notes.forEach((note, index) => {
                    setTimeout(() => {
                        instruments.piano.triggerAttackRelease(note + '4', '2n');
                    }, index * 50);
                });
            }
        };
        
        // Generate bass line from chord progression
        const generateBassLine = () => {
            if (currentProgression.length === 0) {
                alert('Load a chord progression first!');
                return;
            }
            
            // Clear existing bass notes
            trackNotes.bass = [];
            document.getElementById('bass-notes').innerHTML = '';
            
            // Generate bass line
            currentProgression.forEach((chord, index) => {
                const rootNote = chordNotes[chord] ? chordNotes[chord][0] + '2' : 'C2';
                const noteData = { note: rootNote, duration: '2n' };
                trackNotes.bass.push(noteData);
                
                // Add to display
                const noteChip = document.createElement('span');
                noteChip.className = 'note-chip';
                noteChip.textContent = `${rootNote} (2n)`;
                noteChip.onclick = () => {
                    initAudio().then(() => {
                        instruments.bass.triggerAttackRelease(rootNote, '2n');
                    });
                };
                document.getElementById('bass-notes').appendChild(noteChip);
            });
            
            alert(`Generated ${currentProgression.length} bass notes!`);
        };
        
        // Generate arpeggio pattern
        const generateArpeggio = () => {
            if (currentProgression.length === 0) {
                alert('Load a chord progression first!');
                return;
            }
            
            // Clear existing harp notes
            trackNotes.harp = [];
            document.getElementById('harp-notes').innerHTML = '';
            
            // Generate arpeggios
            currentProgression.forEach(chord => {
                const notes = chordNotes[chord];
                if (notes) {
                    notes.forEach(note => {
                        const noteData = { note: note + '4', duration: '8n' };
                        trackNotes.harp.push(noteData);
                        
                        // Add to display
                        const noteChip = document.createElement('span');
                        noteChip.className = 'note-chip';
                        noteChip.textContent = `${note}4 (8n)`;
                        noteChip.onclick = () => {
                            initAudio().then(() => {
                                instruments.harp.triggerAttackRelease(note + '4', '8n');
                            });
                        };
                        document.getElementById('harp-notes').appendChild(noteChip);
                    });
                }
            });
            
            alert(`Generated arpeggio pattern!`);
        };
        
        // Harmonize melody (add harmony to piano notes)
        const harmonizeMelody = () => {
            if (trackNotes.piano.length === 0) {
                alert('Add some piano notes first!');
                return;
            }
            
            if (currentProgression.length === 0) {
                alert('Load a chord progression first!');
                return;
            }
            
            // Clear existing violin notes
            trackNotes.violin = [];
            document.getElementById('violin-notes').innerHTML = '';
            
            // Generate harmony notes (thirds above)
            trackNotes.piano.forEach(pianoNote => {
                const noteName = pianoNote.note.replace(/\d+/, '');
                const octave = pianoNote.note.replace(/[^0-9]/g, '');
                
                // Find harmony note (third above)
                const scaleArray = scaleNotes[currentKey] || scaleNotes['D'];
                const noteIndex = scaleArray.findIndex(n => n === noteName);
                if (noteIndex !== -1) {
                    const harmonyNote = scaleArray[(noteIndex + 2) % scaleArray.length];
                    const harmonyNoteData = { 
                        note: harmonyNote + octave, 
                        duration: pianoNote.duration 
                    };
                    trackNotes.violin.push(harmonyNoteData);
                    
                    // Add to display
                    const noteChip = document.createElement('span');
                    noteChip.className = 'note-chip';
                    noteChip.textContent = `${harmonyNote}${octave} (${pianoNote.duration})`;
                    noteChip.onclick = () => {
                        initAudio().then(() => {
                            instruments.violin.triggerAttackRelease(harmonyNote + octave, pianoNote.duration);
                        });
                    };
                    document.getElementById('violin-notes').appendChild(noteChip);
                }
            });
            
            alert('Generated harmony for piano melody!');
        };
        
        // Update scale notes display
        const updateScaleNotes = () => {
            const key = document.getElementById('key-select').value;
            currentKey = key;
            const notes = scaleNotes[key] || scaleNotes['D'];
            document.getElementById('scale-notes').textContent = notes.join(' ');
        };
        const toggleStep = (instrument, step) => {
            sequences[instrument][step] = !sequences[instrument][step];
            const stepElement = document.querySelectorAll(`#${instrument}-grid .step`)[step];
            stepElement.classList.toggle('active', sequences[instrument][step]);
        };
        
        // Set volume for instrument
        const setVolume = (instrument, volume) => {
            const vol = parseFloat(volume);
            trackVolumes[instrument] = vol;
            if (instruments[instrument]) {
                instruments[instrument].volume.value = Tone.gainToDb(vol);
            }
        };
        
        // Add note to track
        const addNote = (instrument) => {
            const noteInput = document.getElementById(`${instrument}-note`);
            const durationSelect = document.getElementById(`${instrument}-duration`);
            const notesDisplay = document.getElementById(`${instrument}-notes`);
            
            const note = noteInput.value.trim();
            const duration = durationSelect.value;
            
            if (note) {
                // Store note data
                trackNotes[instrument].push({ note, duration });
                
                const noteChip = document.createElement('span');
                noteChip.className = 'note-chip';
                noteChip.textContent = `${note} (${duration})`;
                noteChip.onclick = () => {
                    // Play note when clicked
                    initAudio().then(() => {
                        if (instrument === 'drums') {
                            // Play different drum sounds based on note
                            const drumNote = note.toUpperCase();
                            if (drumNote.includes('KICK') || drumNote.includes('K')) {
                                instruments[instrument].triggerAttackRelease('C1', duration);
                            } else if (drumNote.includes('SNARE') || drumNote.includes('S')) {
                                instruments[instrument].triggerAttackRelease('C3', duration);
                            } else if (drumNote.includes('HAT') || drumNote.includes('H')) {
                                instruments[instrument].triggerAttackRelease('C5', duration);
                            } else {
                                instruments[instrument].triggerAttackRelease('C2', duration);
                            }
                        } else {
                            instruments[instrument].triggerAttackRelease(note, duration);
                        }
                    });
                };
                notesDisplay.appendChild(noteChip);
                noteInput.value = '';
            }
        };
        
        // Update tempo
        const updateTempo = (value) => {
            Tone.Transport.bpm.value = parseInt(value);
            document.getElementById('tempo-value').textContent = value;
        };
        
        // Play sequence
        const playSequence = async () => {
            await initAudio();
            
            if (isPlaying) return;
            isPlaying = true;
            currentStep = 0;
            
            const stepDuration = 60 / (Tone.Transport.bpm.value * 4); // 16th notes
            
            const playStep = () => {
                if (!isPlaying) return;
                
                // Clear previous playing indicators
                document.querySelectorAll('.step.playing').forEach(el => {
                    el.classList.remove('playing');
                });
                
                // Highlight current step
                Object.keys(sequences).forEach(instrument => {
                    const stepElement = document.querySelectorAll(`#${instrument}-grid .step`)[currentStep];
                    stepElement.classList.add('playing');
                    
                    // Play note if step is active
                    if (sequences[instrument][currentStep]) {
                        if (instrument === 'drums') {
                            // Cycle through different drum sounds for sequencer
                            const drumSounds = ['C1', 'C3', 'C5', 'C2'];
                            const drumNote = drumSounds[currentStep % 4];
                            instruments[instrument].triggerAttackRelease(drumNote, '16n');
                        } else {
                            // Use a default note for sequencer playback
                            const defaultNotes = {
                                piano: 'C4',
                                guitar: 'E3',
                                bass: 'C2',
                                violin: 'G4',
                                harp: 'C5',
                                saxophone: 'F4',
                                vocal: 'A4'
                            };
                            instruments[instrument].triggerAttackRelease(defaultNotes[instrument] || 'C4', '16n');
                        }
                    }
                });
                
                currentStep = (currentStep + 1) % 32;
                stepTimeout = setTimeout(playStep, stepDuration * 1000);
            };
            
            playStep();
        };
        
        // Stop sequence
        const stopSequence = () => {
            isPlaying = false;
            clearTimeout(stepTimeout);
            
            // Clear playing indicators
            document.querySelectorAll('.step.playing').forEach(el => {
                el.classList.remove('playing');
            });
        };
        
        // Clear all sequences
        const clearAll = () => {
            stopSequence();
            
            Object.keys(sequences).forEach(instrument => {
                sequences[instrument] = new Array(32).fill(false);
                trackNotes[instrument] = [];
                document.querySelectorAll(`#${instrument}-grid .step`).forEach(step => {
                    step.classList.remove('active');
                });
                document.getElementById(`${instrument}-notes`).innerHTML = '';
            });
        };
        
        // Export composition
        const exportComposition = () => {
            const composition = {
                tempo: Tone.Transport.bpm.value,
                sequences: sequences,
                notes: trackNotes,
                volumes: trackVolumes,
                timestamp: new Date().toISOString(),
                version: "1.0"
            };
            
            const dataStr = JSON.stringify(composition, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'text/plain' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `composition_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            link.click();
            
            alert('Composition exported! Save this .txt file and use Import to load it later.');
        };
        
        // Import composition
        const importComposition = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const composition = JSON.parse(e.target.result);
                    
                    // Clear current composition
                    clearAll();
                    
                    // Load tempo
                    if (composition.tempo) {
                        Tone.Transport.bpm.value = composition.tempo;
                        document.getElementById('tempo').value = composition.tempo;
                        document.getElementById('tempo-value').textContent = composition.tempo;
                    }
                    
                    // Load sequences
                    if (composition.sequences) {
                        Object.keys(composition.sequences).forEach(instrument => {
                            if (sequences[instrument]) {
                                sequences[instrument] = composition.sequences[instrument];
                                composition.sequences[instrument].forEach((active, index) => {
                                    const stepElement = document.querySelectorAll(`#${instrument}-grid .step`)[index];
                                    if (stepElement) {
                                        stepElement.classList.toggle('active', active);
                                    }
                                });
                            }
                        });
                    }
                    
                    // Load notes
                    if (composition.notes) {
                        Object.keys(composition.notes).forEach(instrument => {
                            if (trackNotes[instrument]) {
                                trackNotes[instrument] = composition.notes[instrument];
                                const notesDisplay = document.getElementById(`${instrument}-notes`);
                                composition.notes[instrument].forEach(noteData => {
                                    const noteChip = document.createElement('span');
                                    noteChip.className = 'note-chip';
                                    noteChip.textContent = `${noteData.note} (${noteData.duration})`;
                                    noteChip.onclick = () => {
                                        initAudio().then(() => {
                                            if (instrument === 'drums') {
                                                const drumNote = noteData.note.toUpperCase();
                                                if (drumNote.includes('KICK') || drumNote.includes('K')) {
                                                    instruments[instrument].triggerAttackRelease('C1', noteData.duration);
                                                } else if (drumNote.includes('SNARE') || drumNote.includes('S')) {
                                                    instruments[instrument].triggerAttackRelease('C3', noteData.duration);
                                                } else if (drumNote.includes('HAT') || drumNote.includes('H')) {
                                                    instruments[instrument].triggerAttackRelease('C5', noteData.duration);
                                                } else {
                                                    instruments[instrument].triggerAttackRelease('C2', noteData.duration);
                                                }
                                            } else {
                                                instruments[instrument].triggerAttackRelease(noteData.note, noteData.duration);
                                            }
                                        });
                                    };
                                    notesDisplay.appendChild(noteChip);
                                });
                            }
                        });
                    }
                    
                    // Load volumes
                    if (composition.volumes) {
                        Object.keys(composition.volumes).forEach(instrument => {
                            if (trackVolumes[instrument] !== undefined) {
                                const volume = composition.volumes[instrument];
                                trackVolumes[instrument] = volume;
                                const volumeSlider = document.querySelector(`#tracks input[onchange*="${instrument}"]`);
                                if (volumeSlider) {
                                    volumeSlider.value = volume;
                                    setVolume(instrument, volume);
                                }
                            }
                        });
                    }
                    
                    alert('Composition loaded successfully!');
                } catch (error) {
                    alert('Error loading composition: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        };
        
        // Initialize everything when page loads
        window.addEventListener('load', async () => {
            await initTracks();
            
            // Load Canon in D as demo
            loadProgression('canon');
            
            // Add some demo melody notes for Canon
            const canonMelody = [
                { note: 'D5', duration: '2n' },
                { note: 'A4', duration: '4n' },
                { note: 'B4', duration: '4n' },
                { note: 'F#4', duration: '2n' },
                { note: 'G4', duration: '4n' },
                { note: 'D4', duration: '4n' },
                { note: 'G4', duration: '2n' },
                { note: 'A4', duration: '1n' }
            ];
            
            // Add Canon melody to piano
            trackNotes.piano = canonMelody;
            const pianoNotesDisplay = document.getElementById('piano-notes');
            canonMelody.forEach(noteData => {
                const noteChip = document.createElement('span');
                noteChip.className = 'note-chip';
                noteChip.textContent = `${noteData.note} (${noteData.duration})`;
                noteChip.onclick = () => {
                    initAudio().then(() => {
                        instruments.piano.triggerAttackRelease(noteData.note, noteData.duration);
                    });
                };
                pianoNotesDisplay.appendChild(noteChip);
            });
        });
    </script>
</body>
</html>
